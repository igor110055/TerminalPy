<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Load plotly.js into the DOM -->
	<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
</head>
<body>
    <div id="Tschaat"></div>
    <button>scaling</button>
    <script>
     
            // //Fetch Data for MA Indikator
            // const respo = await fetch("http://localhost:5500/Indicators");
            // const ans = await respo.json();
            // console.log('ans',ans);
            // //Push Data to Templates
            // //Rendering Line Chart
            // ans.Line.forEach(element => {
            //     data.push(element)
            // });
            // //Rendering Marker Chart
            // ans.Marker.forEach(element => {
            //     data.push(element)
            // });
            
            //Declaring the Creator function

        let creator = (array)=>{
            //Creating the Candlestick object that will be pushed into the 
            candleStick = {
                //X-Axis
                x: [],
                //Y-Axis
                close :[], 
                high :[], 
                line: {col :'rgba(31,119,180,1)'}, 
                low: [],
                open: [],
                //Config
                type: 'candlestick', 
                xaxis: 'x', 
                yaxis:'y'
            };

            var layout = {
                dragmode: 'zoom', 
                margin: {
                    r: 10, 
                    t: 25, 
                    b: 40, 
                    l: 60
                }, 
                showlegend: false, 
                xaxis: {
                    autorange: true, 
                    domain: [0, 1], 
                    range: [candleStick.x[0],candleStick.x[candleStick.x.length-1]], //Chart Range
                    rangeslider: {range: [candleStick.x[0],candleStick.x[candleStick.x.length-1]]}, //RangeSlider Range
                    type: 'date'
                }, 
                yaxis: {
                    autorange: true, 
                    domain: [0, 1], 
                    type: 'log',
                    fixedrange: false,
                    //rangeslider: {range: [candleStick.x[0],candleStick.x[candleStick.x.length-1]]},
                }
            };

            for (element of array){
                candleStick.x.push( new Date(element[0]*1000).toISOString())
                candleStick.high.push(parseFloat(element[2]))
                candleStick.low.push(parseFloat(element[3]))
                candleStick.open.push(parseFloat(element[1]))
                candleStick.close.push(parseFloat(element[4]))
            };

            return {candleStick,layout}
        }
        let dataFetcher = async () => {
            let flask = 'http://127.0.0.1:5000/Indicators'
            let node = 'http://localhost:5000/OHLC'
            //Fetch the CandleStick data
            const response = await fetch(flask);
            const answer = await response.json();
            //Execution of the creator with the fetched data as argument
            let toRender = await creator(answer.OHLC)
            return toRender
        }

        let ChartJSgenerator = async function () {
            //Rendering new Plot
            let Data = await dataFetcher()
            // let Layout = await dataFetcher()
            console.log(Data.candleStick,Data.layout);
            // Plotly.newPlot('Tschaat', dataFetcher.candleStick, dataFetcher.layout);
            Plotly.newPlot('Tschaat',Data.candleStick,Data.layout);
        }
        ChartJSgenerator()
        

    </script>
</body>
</html>